<section class="page admin-page">
    <header class="page-header">
        <h1>Admin</h1>
        <p class="page-description">Manage projects and their sources</p>
    </header>
    
    <div class="page-content-wrapper">
        <!-- Projects Section -->
        <div class="admin-grid">
            <!-- Left Column: Project Selection and Management -->
            <div class="admin-column">
                <!-- Project List -->
                <div class="card">
                    <h2>Projects</h2>
                    <div id="projects-container">
                        <div class="loading">No projects found.</div>
                    </div>
                </div>

                <!-- Create New Project -->
                <div class="card">
                    <h2>Create New Project</h2>
                    <form id="create-project-form" method="POST" hx-post="/api/projects/create" hx-target="#projects-container" hx-swap="innerHTML" hx-on::after-request="clearFormOnSuccess(event)">
                        <div class="form-group">
                            <label for="project-name">Project Name *</label>
                            <input type="text" id="project-name" name="name" required placeholder="e.g., My RAG Project">
                        </div>
                        
                        <div class="form-group">
                            <label for="project-description">Description</label>
                            <textarea id="project-description" name="description" placeholder="Describe your project..." rows="3"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="project-llm">LLM Model</label>
                                <select id="project-llm" name="llm">
                                    <option value="gemini" selected>Gemini</option>
                                    <option value="openai">OpenAI</option>
                                    <option value="claude">Claude</option>
                                    <option value="huggingface">HuggingFace</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="project-embed">Embed Model</label>
                                <select id="project-embed" name="embed_model">
                                    <option value="gemini" selected>Gemini</option>
                                    <option value="openai">OpenAI</option>
                                    <option value="huggingface">HuggingFace</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Create Project</button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Project Details and Sources -->
            <div class="admin-column">
                <div id="project-details-container">
                    <div class="card">
                        <p class="text-muted">Select a project from the list to manage its sources</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load projects on page initialization -->
    <script>
        // Clear form after successful project creation
        function clearFormOnSuccess(event) {
            // Only clear if request was successful (status 200)
            if (event.detail.xhr.status === 200) {
                console.log('[admin] Project created successfully, clearing form');
                document.getElementById('create-project-form').reset();
            }
        }

        // Ensure form submits via HTMX, not default browser behavior
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('create-project-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('[admin] Form submit event intercepted');
                    // Let HTMX handle it - don't prevent default
                });
            }
        });

        // These functions are page-specific and not in global scope
        function loadProjects() {
            const container = document.getElementById('projects-container');
            if (!container) {
                console.warn('[admin] projects-container not found');
                return;
            }
            console.log('[admin] Loading projects...');
            fetch('/api/projects')
                .then(response => response.text())
                .then(html => {
                    console.log('[admin] Projects loaded');
                    container.innerHTML = html;
                })
                .catch(error => {
                    console.error('Error loading projects:', error);
                    container.innerHTML = '<div class="error">Failed to load projects</div>';
                });
        }

        // Load projects when page is loaded
        console.log('[admin] Script executed');
        loadProjects();
        
        // Also listen to the custom pageLoaded event
        document.addEventListener('pageLoaded', function(e) {
            if (e.detail && e.detail.url && e.detail.url.includes('/admin')) {
                console.log('[admin] pageLoaded event received');
                loadProjects();
            }
        });
    </script>
</section>
